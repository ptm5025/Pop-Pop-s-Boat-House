
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pop Pop's Boat House</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            color: #ffffff;
            overflow-x: hidden;
            background: #0a0e1a;
        }

        .hero-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: url('Sunset.jpg') center center/cover no-repeat;
            z-index: -2;
        }

        .hero-background::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                135deg,
                rgba(15, 25, 45, 0.85) 0%,
                rgba(30, 50, 80, 0.75) 30%,
                rgba(45, 75, 115, 0.65) 60%,
                rgba(20, 40, 70, 0.8) 100%
            );
            backdrop-filter: blur(1px);
        }

        .container {
            position: relative;
            z-index: 1;
            min-height: 100vh;
        }

        .hero-section {
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 2rem;
            background: linear-gradient(
                to bottom,
                rgba(0, 0, 0, 0.3) 0%,
                rgba(0, 0, 0, 0.1) 50%,
                rgba(0, 0, 0, 0.4) 100%
            );
        }

        .hero-title {
            font-size: clamp(3rem, 8vw, 6rem);
            font-weight: 700;
            margin-bottom: 1rem;
            text-shadow: 2px 4px 20px rgba(0, 0, 0, 0.7);
            background: linear-gradient(135deg, #ffffff 0%, #e3f2ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: fadeInUp 1s ease-out;
        }

        .hero-subtitle {
            font-size: clamp(1.2rem, 3vw, 1.8rem);
            font-weight: 300;
            margin-bottom: 2rem;
            opacity: 0.9;
            text-shadow: 1px 2px 10px rgba(0, 0, 0, 0.5);
            animation: fadeInUp 1s ease-out 0.3s both;
        }

        .scroll-indicator {
            position: absolute;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            animation: bounce 2s infinite;
        }

        .scroll-arrow {
            width: 2px;
            height: 40px;
            background: linear-gradient(to bottom, transparent, rgba(255, 255, 255, 0.8));
            border-radius: 2px;
            margin: 0 auto;
        }

        .content-section {
            background: linear-gradient(
                to bottom,
                rgba(10, 14, 26, 0.95) 0%,
                rgba(15, 25, 45, 0.98) 100%
            );
            backdrop-filter: blur(20px);
            min-height: 100vh;
            padding: 4rem 2rem;
        }

        .weather-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .current-weather-hero {
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.1) 0%, 
                rgba(255, 255, 255, 0.05) 100%
            );
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 3rem;
            margin-bottom: 3rem;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .current-weather-hero:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.4);
        }

        .weather-icon-large {
            font-size: 4rem;
            margin-bottom: 1rem;
            filter: drop-shadow(0 4px 15px rgba(0, 0, 0, 0.3));
        }

        .temp-display {
            font-size: clamp(4rem, 10vw, 6rem);
            font-weight: 700;
            margin: 1rem 0;
            background: linear-gradient(135deg, #74b9ff 0%, #00cec9 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 2px 4px 20px rgba(0, 0, 0, 0.3);
        }

        .weather-desc {
            font-size: 1.5rem;
            font-weight: 300;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 2rem;
            text-transform: capitalize;
        }

        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            padding: 1.5rem;
            border-radius: 16px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-item:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-3px);
        }

        .stat-label {
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: #ffffff;
        }

        .section-title {
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 2rem;
            text-align: center;
            background: linear-gradient(135deg, #ffffff 0%, #e3f2ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2rem;
            margin-bottom: 4rem;
        }

        .glass-card {
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.1) 0%, 
                rgba(255, 255, 255, 0.05) 100%
            );
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 2rem;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: #ffffff;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .marine-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .marine-stat {
            background: rgba(0, 206, 201, 0.15);
            border: 1px solid rgba(0, 206, 201, 0.3);
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .marine-stat:hover {
            background: rgba(0, 206, 201, 0.25);
            transform: scale(1.02);
        }

        .marine-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #00cec9;
            margin: 0.5rem 0;
        }

        .marine-label {
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.8);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .tide-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .tide-item {
            background: rgba(116, 185, 255, 0.15);
            border: 1px solid rgba(116, 185, 255, 0.3);
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
        }

        .tide-type {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .high-tide { color: #74b9ff; }
        .low-tide { color: #ff7675; }

        .tide-time {
            font-size: 1.1rem;
            font-weight: 500;
            color: #ffffff;
            margin-bottom: 0.25rem;
        }

        .tide-height {
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .forecast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 1rem;
        }

        .forecast-day {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            padding: 1.5rem 1rem;
            border-radius: 16px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .forecast-day:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-3px);
        }

        .day-name {
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 0.5rem;
        }

        .day-icon {
            font-size: 2rem;
            margin: 0.5rem 0;
        }

        .day-temps {
            font-size: 1.1rem;
            font-weight: 500;
            color: #74b9ff;
            margin: 0.5rem 0;
        }

        .day-desc {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 0.5rem;
        }

        .radar-container {
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.1) 0%, 
                rgba(255, 255, 255, 0.05) 100%
            );
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 3rem;
        }

        .radar-frame {
            width: 100%;
            height: 500px;
            border: none;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .last-updated {
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.875rem;
            margin-top: 2rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .refresh-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(116, 185, 255, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .refresh-btn:hover {
            transform: scale(1.1) rotate(180deg);
            box-shadow: 0 12px 35px rgba(116, 185, 255, 0.6);
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            color: rgba(255, 255, 255, 0.7);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.2);
            border-top: 3px solid #74b9ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 1rem;
        }

        .error {
            background: rgba(255, 118, 117, 0.2);
            border: 1px solid rgba(255, 118, 117, 0.4);
            color: #ff7675;
            padding: 1rem;
            border-radius: 12px;
            text-align: center;
            margin: 1rem 0;
        }

        .secondary-photo {
            position: fixed;
            bottom: 2rem;
            left: 2rem;
            width: 120px;
            height: 80px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            z-index: 999;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.7rem;
            text-align: center;
        }

        .secondary-photo:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.6);
        }

        .secondary-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .secondary-photo .placeholder-text {
            padding: 0.5rem;
            line-height: 1.2;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateX(-50%) translateY(0);
            }
            40% {
                transform: translateX(-50%) translateY(-10px);
            }
            60% {
                transform: translateX(-50%) translateY(-5px);
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .hero-section {
                padding: 1rem;
            }
            
            .content-section {
                padding: 2rem 1rem;
            }
            
            .current-weather-hero {
                padding: 2rem 1rem;
            }
            
            .cards-grid {
                grid-template-columns: 1fr;
            }
            
            .glass-card {
                padding: 1.5rem;
            }
            
            .secondary-photo {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="hero-background"></div>
    
    <div class="container">
        <!-- Hero Section -->
        <div class="hero-section">
            <h1 class="hero-title">‚öì Pop Pop's Boat House</h1>
            <p class="hero-subtitle">Ocean Pines Weather Station</p>
            <div class="scroll-indicator">
                <div class="scroll-arrow"></div>
            </div>
        </div>

        <!-- Weather Content -->
        <div class="content-section">
            <div class="weather-container">
                <!-- Current Weather Hero -->
                <div class="current-weather-hero" id="currentWeather">
                    <div class="loading">
                        <div class="spinner"></div>
                        Loading current conditions...
                    </div>
                </div>

                <!-- Marine Conditions -->
                <div class="glass-card">
                    <h2 class="card-title">üåä Marine Conditions</h2>
                    <div class="marine-grid" id="marineGrid">
                        <div class="loading">
                            <div class="spinner"></div>
                            Loading marine data...
                        </div>
                    </div>
                </div>

                <!-- Tides -->
                <div class="glass-card">
                    <h2 class="card-title">üåä Today's Tides (Ocean City)</h2>
                    <div class="tide-grid" id="tideGrid">
                        <div class="loading">
                            <div class="spinner"></div>
                            Loading tide data...
                        </div>
                    </div>
                </div>

                <!-- 7-Day Forecast -->
                <div class="glass-card">
                    <h2 class="card-title">üìÖ 7-Day Forecast</h2>
                    <div class="forecast-grid" id="forecastGrid">
                        <div class="loading">
                            <div class="spinner"></div>
                            Loading forecast...
                        </div>
                    </div>
                </div>

                <!-- Weather Radar -->
                <div class="radar-container">
                    <h2 class="section-title">üå¶Ô∏è Weather Radar & Marine Charts</h2>
                    <iframe 
                        class="radar-frame"
                        src="https://embed.windy.com/embed.html?type=map&location=coordinates&metricRain=default&metricTemp=default&metricWind=default&zoom=10&overlay=waves&product=ecmwf&level=surface&lat=38.39&lon=-75.15"
                        frameborder="0">
                    </iframe>
                    <p style="text-align: center; margin-top: 1rem; color: rgba(255, 255, 255, 0.7); font-size: 0.875rem;">
                        üí° Click the layers button to switch between rain, waves, wind, and temperature
                    </p>
                </div>

                <div class="last-updated" id="lastUpdated">
                    Loading coastal weather data...
                </div>
            </div>
        </div>
    </div>

    <!-- Secondary Photo -->
    <div class="secondary-photo" id="secondaryPhoto">
        <img src="Mom-Dad-Boat.jpg" alt="Livin' The Dream" 
             onerror="this.style.display='none'; document.getElementById('secondaryPhoto').innerHTML='<div class=&quot;placeholder-text&quot;>üì∏<br>Livin&#39; The Dream<br><small>Photo missing</small></div>';">
    </div>

    <!-- Refresh Button -->
    <button class="refresh-btn" onclick="refreshWeather()" title="Refresh Weather Data">
        üîÑ
    </button>

    <script>
        // Ocean Pines coordinates
        const LATITUDE = 38.39;
        const LONGITUDE = -75.15;
        
        // Ocean City NOAA tide station
        const TIDE_STATION = '8570283';

        // Weather and marine data storage
        let weatherData = {};
        let marineData = {};
        let tideData = {};

        // Initialize the weather station
        async function initWeatherStation() {
            console.log('Initializing Ocean Pines Coastal Weather Station...');
            await Promise.all([
                loadWeatherData(),
                loadMarineData(),
                loadTideData()
            ]);
            
            // Auto-refresh every 10 minutes
            setInterval(refreshWeather, 10 * 60 * 1000);
        }

        // Load weather data from Open-Meteo API
        async function loadWeatherData() {
            try {
                updateLastUpdated('Loading fresh weather data...');
                
                const currentResponse = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${LATITUDE}&longitude=${LONGITUDE}&current=temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,weather_code,wind_speed_10m,wind_direction_10m,pressure_msl,visibility&hourly=temperature_2m,relative_humidity_2m,precipitation_probability,weather_code,visibility&daily=weather_code,temperature_2m_max,temperature_2m_min,precipitation_sum,wind_speed_10m_max&temperature_unit=fahrenheit&wind_speed_unit=mph&precipitation_unit=inch&timezone=America/New_York`);
                
                if (!currentResponse.ok) {
                    throw new Error(`Weather API responded with status: ${currentResponse.status}`);
                }
                
                weatherData = await currentResponse.json();
                console.log('Weather data loaded successfully');
                
                renderCurrentWeather();
                renderForecast();
                
            } catch (error) {
                console.error('Error loading weather data:', error);
                showError('currentWeather', 'Unable to load weather data. Please check your internet connection and try again.');
            }
        }

        // Load marine data from Open-Meteo Marine API
        async function loadMarineData() {
            try {
                const marineResponse = await fetch(`https://marine-api.open-meteo.com/v1/marine?latitude=${LATITUDE}&longitude=${LONGITUDE}&current=wave_height,wave_direction,wave_period,wind_wave_height,wind_wave_direction,wind_wave_period,swell_wave_height,swell_wave_direction,swell_wave_period&hourly=wave_height,swell_wave_height&daily=wave_height_max,swell_wave_height_max&timezone=America/New_York`);
                
                if (!marineResponse.ok) {
                    throw new Error(`Marine API responded with status: ${marineResponse.status}`);
                }
                
                marineData = await marineResponse.json();
                console.log('Marine data loaded successfully');
                
                renderMarineConditions();
                
            } catch (error) {
                console.error('Error loading marine data:', error);
                // Show sample marine data as fallback
                showSampleMarineData();
            }
        }

        // Show sample marine data if API fails
        function showSampleMarineData() {
            const marineGrid = document.getElementById('marineGrid');
            
            // Generate realistic sample marine data for Ocean Pines area
            const sampleMarine = {
                wave_height: 1.2,
                swell_wave_height: 0.8,
                wind_wave_height: 0.6,
                ocean_current_velocity: 0.3,
                wave_direction: 180,
                ocean_current_direction: 90
            };
            
            marineGrid.innerHTML = `
                <div class="marine-stat">
                    <div class="marine-label">üåä Wave Height</div>
                    <div class="marine-value">${sampleMarine.wave_height.toFixed(1)} ft</div>
                    <div style="font-size: 0.75rem; color: rgba(255,255,255,0.6);">
                        ${getWindDirection(sampleMarine.wave_direction)}
                    </div>
                </div>
                <div class="marine-stat">
                    <div class="marine-label">üèÑ‚Äç‚ôÇÔ∏è Swell</div>
                    <div class="marine-value">${sampleMarine.swell_wave_height.toFixed(1)} ft</div>
                    <div style="font-size: 0.75rem; color: rgba(255,255,255,0.6);">
                        8s period
                    </div>
                </div>
                <div class="marine-stat">
                    <div class="marine-label">üí® Wind Waves</div>
                    <div class="marine-value">${sampleMarine.wind_wave_height.toFixed(1)} ft</div>
                    <div style="font-size: 0.75rem; color: rgba(255,255,255,0.6);">
                        6s period
                    </div>
                </div>
                <div class="marine-stat">
                    <div class="marine-label">üåä Current</div>
                    <div class="marine-value">${sampleMarine.ocean_current_velocity.toFixed(1)} kt</div>
                    <div style="font-size: 0.75rem; color: rgba(255,255,255,0.6);">
                        ${getWindDirection(sampleMarine.ocean_current_direction)}
                    </div>
                </div>
                <div class="marine-stat">
                    <div class="marine-label">üìä Sea State</div>
                    <div class="marine-value" style="font-size: 1.2rem;">${getSeaState(sampleMarine.wave_height)}</div>
                    <div style="font-size: 0.75rem; color: rgba(255,255,255,0.6);">
                        ${getSeaStateDescription(sampleMarine.wave_height)}
                    </div>
                </div>
                <div class="marine-stat">
                    <div class="marine-label">üéØ Conditions</div>
                    <div class="marine-value" style="font-size: 1.1rem;">${getBestMarineActivity(sampleMarine.wave_height, 12)}</div>
                    <div style="font-size: 0.75rem; color: rgba(255,255,255,0.6);">
                        Sample data
                    </div>
                </div>
            `;
        }

        // Load tide data using a CORS proxy for NOAA API
        async function loadTideData() {
            try {
                const today = new Date();
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);
                
                const todayStr = formatDateForNOAA(today);
                const tomorrowStr = formatDateForNOAA(tomorrow);
                
                // Using a CORS proxy to access NOAA API
                const proxyUrl = 'https://api.allorigins.win/raw?url=';
                const noaaUrl = `https://api.tidesandcurrents.noaa.gov/api/prod/datagetter?begin_date=${todayStr}&end_date=${tomorrowStr}&station=${TIDE_STATION}&product=predictions&datum=MLLW&time_zone=lst_ldt&interval=hilo&units=english&format=json`;
                
                const tideResponse = await fetch(proxyUrl + encodeURIComponent(noaaUrl));
                
                if (!tideResponse.ok) {
                    throw new Error(`Tide API responded with status: ${tideResponse.status}`);
                }
                
                tideData = await tideResponse.json();
                console.log('Tide data loaded successfully:', tideData);
                
                renderTideData();
                
            } catch (error) {
                console.error('Error loading tide data:', error);
                // Fallback to sample tide data for demonstration
                showSampleTideData();
            }
        }

        // Show sample tide data if API fails
        function showSampleTideData() {
            const tideGrid = document.getElementById('tideGrid');
            const now = new Date();
            
            // Generate realistic sample tide times for Ocean City
            const sampleTides = [
                { time: new Date(now.getFullYear(), now.getMonth(), now.getDate(), 6, 15), type: 'Low', height: 0.8 },
                { time: new Date(now.getFullYear(), now.getMonth(), now.getDate(), 12, 30), type: 'High', height: 3.2 },
                { time: new Date(now.getFullYear(), now.getMonth(), now.getDate(), 18, 45), type: 'Low', height: 0.5 },
                { time: new Date(now.getFullYear(), now.getMonth(), now.getDate(), 24, 0), type: 'High', height: 3.1 }
            ].filter(tide => tide.time > now); // Only show future tides
            
            const tidesHTML = sampleTides.map(tide => {
                const isHigh = tide.type === 'High';
                
                return `
                    <div class="tide-item">
                        <div class="tide-type ${isHigh ? 'high-tide' : 'low-tide'}">
                            ${isHigh ? '‚¨ÜÔ∏è' : '‚¨áÔ∏è'} ${tide.type.toUpperCase()}
                        </div>
                        <div class="tide-time">
                            ${tide.time.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}
                        </div>
                        <div class="tide-height">
                            ${tide.height.toFixed(1)} ft
                        </div>
                    </div>
                `;
            }).join('');
            
            tideGrid.innerHTML = tidesHTML + 
                '<div style="grid-column: 1/-1; text-align: center; font-size: 0.75rem; color: rgba(255,255,255,0.5); margin-top: 1rem;">Sample data - NOAA API temporarily unavailable</div>';
        }

        // Render current weather conditions
        function renderCurrentWeather() {
            const current = weatherData.current;
            const currentElement = document.getElementById('currentWeather');
            
            if (!current) {
                showError('currentWeather', 'Current weather data not available');
                return;
            }
            
            const weatherDescription = getWeatherDescription(current.weather_code);
            const weatherIcon = getWeatherIcon(current.weather_code);
            
            currentElement.innerHTML = `
                <div class="weather-icon-large">${weatherIcon}</div>
                <div class="temp-display">${Math.round(current.temperature_2m)}¬∞F</div>
                <div class="weather-desc">${weatherDescription}</div>
                <div class="quick-stats">
                    <div class="stat-item">
                        <div class="stat-label">Feels Like</div>
                        <div class="stat-value">${Math.round(current.apparent_temperature)}¬∞F</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Humidity</div>
                        <div class="stat-value">${current.relative_humidity_2m}%</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Wind</div>
                        <div class="stat-value">${Math.round(current.wind_speed_10m)} mph</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Direction</div>
                        <div class="stat-value">${getWindDirection(current.wind_direction_10m)}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Pressure</div>
                        <div class="stat-value">${Math.round(current.pressure_msl * 0.02953)} in</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Visibility</div>
                        <div class="stat-value">${Math.round(current.visibility * 0.000621371)} mi</div>
                    </div>
                </div>
            `;
        }

        // Render marine conditions
        function renderMarineConditions() {
            const current = marineData.current;
            const marineGrid = document.getElementById('marineGrid');
            
            if (!current) {
                showError('marineGrid', 'Marine data not available');
                return;
            }
            
            const waveHeight = current.wave_height ? current.wave_height : 0;
            const swellHeight = current.swell_wave_height ? current.swell_wave_height : 0;
            const windWaveHeight = current.wind_wave_height ? current.wind_wave_height : 0;
            const currentSpeed = current.ocean_current_velocity ? current.ocean_current_velocity : 0;
            
            marineGrid.innerHTML = `
                <div class="marine-stat">
                    <div class="marine-label">üåä Wave Height</div>
                    <div class="marine-value">${waveHeight.toFixed(1)} ft</div>
                    <div style="font-size: 0.75rem; color: rgba(255,255,255,0.6);">
                        ${getWindDirection(current.wave_direction || 0)}
                    </div>
                </div>
                <div class="marine-stat">
                    <div class="marine-label">üèÑ‚Äç‚ôÇÔ∏è Swell</div>
                    <div class="marine-value">${swellHeight.toFixed(1)} ft</div>
                    <div style="font-size: 0.75rem; color: rgba(255,255,255,0.6);">
                        ${current.swell_wave_period ? `${current.swell_wave_period.toFixed(0)}s` : 'N/A'}
                    </div>
                </div>
                <div class="marine-stat">
                    <div class="marine-label">üí® Wind Waves</div>
                    <div class="marine-value">${windWaveHeight.toFixed(1)} ft</div>
                    <div style="font-size: 0.75rem; color: rgba(255,255,255,0.6);">
                        ${current.wind_wave_period ? `${current.wind_wave_period.toFixed(0)}s` : 'N/A'}
                    </div>
                </div>
                <div class="marine-stat">
                    <div class="marine-label">üåä Current</div>
                    <div class="marine-value">${currentSpeed.toFixed(1)} kt</div>
                    <div style="font-size: 0.75rem; color: rgba(255,255,255,0.6);">
                        ${getWindDirection(current.ocean_current_direction || 0)}
                    </div>
                </div>
                <div class="marine-stat">
                    <div class="marine-label">üìä Sea State</div>
                    <div class="marine-value" style="font-size: 1.2rem;">${getSeaState(waveHeight)}</div>
                    <div style="font-size: 0.75rem; color: rgba(255,255,255,0.6);">
                        ${getSeaStateDescription(waveHeight)}
                    </div>
                </div>
                <div class="marine-stat">
                    <div class="marine-label">üéØ Conditions</div>
                    <div class="marine-value" style="font-size: 1.1rem;">${getBestMarineActivity(waveHeight, current.wind_speed_10m)}</div>
                    <div style="font-size: 0.75rem; color: rgba(255,255,255,0.6);">
                        Right now
                    </div>
                </div>
            `;
        }

        // Render tide data
        function renderTideData() {
            const tideGrid = document.getElementById('tideGrid');
            
            if (!tideData.predictions || tideData.predictions.length === 0) {
                showError('tideGrid', 'Tide data not available');
                return;
            }
            
            // Get today's tides
            const today = new Date();
            const todayTides = tideData.predictions.filter(prediction => {
                const tideDate = new Date(prediction.t);
                return tideDate.toDateString() === today.toDateString();
            });
            
            if (todayTides.length === 0) {
                tideGrid.innerHTML = '<div style="text-align: center;">No tide data available for today</div>';
                return;
            }
            
            const tidesHTML = todayTides.map(tide => {
                const time = new Date(tide.t);
                const height = parseFloat(tide.v);
                const type = tide.type.toLowerCase();
                const isHigh = type.includes('high');
                
                return `
                    <div class="tide-item">
                        <div class="tide-type ${isHigh ? 'high-tide' : 'low-tide'}">
                            ${isHigh ? '‚¨ÜÔ∏è' : '‚¨áÔ∏è'} ${type.toUpperCase()}
                        </div>
                        <div class="tide-time">
                            ${time.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}
                        </div>
                        <div class="tide-height">
                            ${height.toFixed(2)} ft
                        </div>
                    </div>
                `;
            }).join('');
            
            tideGrid.innerHTML = tidesHTML;
        }

        // Render 7-day forecast
        function renderForecast() {
            const daily = weatherData.daily;
            const marinDaily = marineData.daily;
            const forecastGrid = document.getElementById('forecastGrid');
            
            if (!daily) {
                showError('forecastGrid', 'Forecast data not available');
                return;
            }
            
            const forecastHTML = daily.time.slice(0, 7).map((date, index) => {
                const dayName = getDayName(date);
                const weatherIcon = getWeatherIcon(daily.weather_code[index]);
                const maxTemp = Math.round(daily.temperature_2m_max[index]);
                const minTemp = Math.round(daily.temperature_2m_min[index]);
                const description = getWeatherDescription(daily.weather_code[index]);
                const maxWaveHeight = marinDaily?.wave_height_max?.[index];
                
                return `
                    <div class="forecast-day">
                        <div class="day-name">${dayName}</div>
                        <div class="day-icon">${weatherIcon}</div>
                        <div class="day-temps">${maxTemp}¬∞ / ${minTemp}¬∞</div>
                        <div class="day-desc">${description}</div>
                        <div style="margin-top: 0.5rem; font-size: 0.75rem; color: rgba(116, 185, 255, 0.8);">
                            üíß ${daily.precipitation_sum[index]}" rain
                        </div>
                        ${maxWaveHeight ? `
                        <div style="margin-top: 0.25rem; font-size: 0.75rem; color: rgba(0, 206, 201, 0.8);">
                            üåä ${maxWaveHeight.toFixed(1)} ft waves
                        </div>` : ''}
                    </div>
                `;
            }).join('');
            
            forecastGrid.innerHTML = forecastHTML;
        }

        // Helper functions
        function formatDateForNOAA(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}${month}${day}`;
        }

        function getDayName(dateString) {
            const date = new Date(dateString);
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            if (date.toDateString() === today.toDateString()) {
                return 'Today';
            } else if (date.toDateString() === tomorrow.toDateString()) {
                return 'Tomorrow';
            } else {
                return date.toLocaleDateString('en-US', { weekday: 'short' });
            }
        }

        function getWeatherDescription(code) {
            const descriptions = {
                0: 'Clear sky',
                1: 'Mainly clear',
                2: 'Partly cloudy',
                3: 'Overcast',
                45: 'Foggy',
                48: 'Depositing rime fog',
                51: 'Light drizzle',
                53: 'Moderate drizzle',
                55: 'Dense drizzle',
                61: 'Slight rain',
                63: 'Moderate rain',
                65: 'Heavy rain',
                71: 'Slight snow',
                73: 'Moderate snow',
                75: 'Heavy snow',
                77: 'Snow grains',
                80: 'Slight rain showers',
                81: 'Moderate rain showers',
                82: 'Violent rain showers',
                85: 'Slight snow showers',
                86: 'Heavy snow showers',
                95: 'Thunderstorm',
                96: 'Thunderstorm with slight hail',
                99: 'Thunderstorm with heavy hail'
            };
            return descriptions[code] || 'Unknown';
        }

        function getWeatherIcon(code) {
            const icons = {
                0: '‚òÄÔ∏è',
                1: 'üå§Ô∏è',
                2: '‚õÖ',
                3: '‚òÅÔ∏è',
                45: 'üå´Ô∏è',
                48: 'üå´Ô∏è',
                51: 'üå¶Ô∏è',
                53: 'üå¶Ô∏è',
                55: 'üå¶Ô∏è',
                61: 'üåßÔ∏è',
                63: 'üåßÔ∏è',
                65: 'üåßÔ∏è',
                71: 'üå®Ô∏è',
                73: 'üå®Ô∏è',
                75: '‚ùÑÔ∏è',
                77: 'üå®Ô∏è',
                80: 'üå¶Ô∏è',
                81: 'üå¶Ô∏è',
                82: '‚õàÔ∏è',
                85: 'üå®Ô∏è',
                86: '‚ùÑÔ∏è',
                95: '‚õàÔ∏è',
                96: '‚õàÔ∏è',
                99: '‚õàÔ∏è'
            };
            return icons[code] || 'üå§Ô∏è';
        }

        function getWindDirection(degrees) {
            const directions = ['N', 'NNE', 'NE', 'ENE', 'E', 'ESE', 'SE', 'SSE', 'S', 'SSW', 'SW', 'WSW', 'W', 'WNW', 'NW', 'NNW'];
            return directions[Math.round(degrees / 22.5) % 16];
        }

        function getSeaState(waveHeight) {
            if (waveHeight < 0.1) return 'Calm';
            if (waveHeight < 0.5) return 'Smooth';
            if (waveHeight < 1.25) return 'Slight';
            if (waveHeight < 2.5) return 'Moderate';
            if (waveHeight < 4) return 'Rough';
            if (waveHeight < 6) return 'Very Rough';
            if (waveHeight < 9) return 'High';
            if (waveHeight < 14) return 'Very High';
            return 'Phenomenal';
        }

        function getSeaStateDescription(waveHeight) {
            if (waveHeight < 0.1) return 'Mirror seas';
            if (waveHeight < 0.5) return 'Ripples only';
            if (waveHeight < 1.25) return 'Small wavelets';
            if (waveHeight < 2.5) return 'Large wavelets';
            if (waveHeight < 4) return 'Small waves';
            if (waveHeight < 6) return 'Moderate waves';
            if (waveHeight < 9) return 'Large waves';
            if (waveHeight < 14) return 'Very large waves';
            return 'Exceptional waves';
        }

        function getBestMarineActivity(waveHeight, windSpeed = 0) {
            if (waveHeight < 1 && windSpeed < 10) return 'üèä‚Äç‚ôÄÔ∏è Perfect Swimming';
            if (waveHeight < 2 && windSpeed < 15) return 'üö§ Great Boating';
            if (waveHeight < 3 && windSpeed < 20) return 'üé£ Good Fishing';
            if (waveHeight < 4) return '‚öì Harbor Time';
            return 'üè† Stay Ashore';
        }

        function updateLastUpdated(message) {
            const lastUpdatedElement = document.getElementById('lastUpdated');
            if (message) {
                lastUpdatedElement.textContent = message;
            } else {
                const now = new Date();
                lastUpdatedElement.textContent = `Last updated: ${now.toLocaleTimeString()} on ${now.toLocaleDateString()}`;
            }
        }

        function showError(elementId, message) {
            const element = document.getElementById(elementId);
            if (element) {
                element.innerHTML = `<div class="error">‚ö†Ô∏è ${message}</div>`;
            }
        }

        // Refresh weather data
        async function refreshWeather() {
            console.log('Refreshing weather data...');
            await Promise.all([
                loadWeatherData(),
                loadMarineData(), 
                loadTideData()
            ]);
            updateLastUpdated();
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initWeatherStation);

        // Page visibility API to refresh when user returns to tab
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                console.log('Page became visible, refreshing weather...');
                refreshWeather();
            }
        });

        // Smooth scrolling for better UX
        document.addEventListener('scroll', function() {
            const scrolled = window.pageYOffset;
            const heroBackground = document.querySelector('.hero-background');
            if (heroBackground) {
                heroBackground.style.transform = `translateY(${scrolled * 0.5}px)`;
            }
        });
    </script>
</body>
</html>
